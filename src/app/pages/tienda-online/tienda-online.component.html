<p-toast></p-toast>
<h1 class="text-center">TU DIVERSIÓN</h1>

<div class="grid">
  <div class="col-12">
    <div class="card">
      <h5>Seleccione los archivos </h5>
      <p-fileUpload name="myfile[]" customUpload="true" (uploadHandler)="onUpload($event)" multiple="multiple" accept=".xlsx" maxFileSize="1000000" chooseLabel="Agregar" uploadLabel="Cargar" cancelLabel="Cancelar">
      </p-fileUpload>
    </div>

    <div class="mb-4" *ngIf="showProgressBar">
      <h5>Barra de progreso</h5>
      <p-progressBar [value]="valueProgressBar"></p-progressBar>
    </div>
    <!--Indicadores-->
    <div class="grid mb-3">
      <div class="col-12 lg:col-4 xl:col-4" *ngFor="let item of listIndicadores">
        <div class="card mb-0">
          <div class="flex justify-content-between mb-3">
            <div>
              <span class="block text-500 font-medium mb-3">{{item.nombre_indicador}}</span>
              <div class="text-900 font-medium text-xl" *ngIf="item.esMoneda">{{item.valor|currency:'$'}}</div>
              <div class="text-900 font-medium text-xl" *ngIf="!item.esMoneda">{{item.valor}}</div>
            </div>
            <div class="flex align-items-center justify-content-center bg-blue-100 border-round" [ngStyle]="{width: '2.5rem', height: '2.5rem'}">
              <i class="pi {{item.icono}} text-blue-500 text-xl"></i>
            </div>
          </div>
          <span class="text-green-500 font-medium">{{item.resaltado}} </span>
          <span class="text-500">{{item.descripcion}}</span>
        </div>
      </div>
    </div>

    <div class="grid">

      <div class="col-12 xl:col-6">
        <div class="card">
          <h5>Modificar productos</h5>
          <p-table [loading]="spinProductos" #tableProductos [value]="listProductos" dataKey="code" [rows]="5" [paginator]="true" responsiveLayout="scroll" [globalFilterFields]="['nombre']">
            <ng-template pTemplate="caption">
              <div class="flex justify-content-between flex-column sm:flex-row">
                <button pButton label="Borrar filtros" class="p-button-outlined mb-2" icon="pi pi-filter-slash" (click)="clear(tableProductos)"></button>
                <span class="p-input-icon-left mb-2">
                    <i class="pi pi-search"></i>
                    <input pInputText type="text" #filterProd (input)="tableProductos.filterGlobal($event.target.value, 'contains')" placeholder="Buscar produccto" class="w-full"/>
                </span>
              </div>
            </ng-template>
            <ng-template pTemplate="header">
              <tr>
                <th>
                  <div class="flex justify-content-between align-items-center">
                    Producto
                  </div>
                </th>
                <th>Costo</th>
                <th></th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-data>
              <tr>
                <td style="min-width: 12rem;">
                  {{data.nombre}}
                </td>
                <td style="min-width: 12rem;">
                  <p-inputNumber mode="decimal" [(ngModel)]="data.costo_unitario"></p-inputNumber>
                </td>
                <td>
                  <button type="button" pButton pRipple icon="pi pi-save" (click)="updateProducto(data)"></button>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="8">Sin registros</td>
              </tr>
            </ng-template>
            <ng-template pTemplate="loadingbody">
              <tr>
                <td colspan="8">Cargando información, por favor espere</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>

      <div class="col-12 xl:col-6">
        <div class="card">
          <h5>Recargas totalizadas</h5>
          <p-table [loading]="spinRecargasTotalizadas" #tableRecargasTotal [value]="listRecargasTotalizados" dataKey="code" [rows]="5" [paginator]="true" responsiveLayout="scroll" [globalFilterFields]="['fecha_recarga','valor_recarga']">
            <ng-template pTemplate="caption">
              <div class="flex justify-content-between flex-column sm:flex-row">
                <button pButton label="Borrar filtros" class="p-button-outlined mb-2" icon="pi pi-filter-slash" (click)="clear(tableRecargasTotal)"></button>
                <div class="p-input-icon-left mb-2">
                  <p-calendar selectionMode="range" [showIcon]="true" [readonlyInput]="true" inputId="touchui" [touchUI]="true" placeholder="Rango de fechas" [(ngModel)]="rangoFechas"></p-calendar>
                  <button type="button" pButton pRipple icon="pi pi-search" class="ml-2" (click)="getRecargasTotalizadoPorFechas()"></button>
                </div>
              </div>
            </ng-template>
            <ng-template pTemplate="header">
              <tr>
                <th pSortableColumn="fecha_recarga">Fecha
                  <p-sortIcon field="fecha_recarga"></p-sortIcon>
                </th>
                <th pSortableColumn="valor_recarga">Valor recarga
                  <p-sortIcon field="valor_recarga"></p-sortIcon>
                </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-data>
              <tr>
                <td style="min-width: 12rem;">
                  {{data.fecha_recarga | date:'dd-MM-yyyy'}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.valor_recarga | currency:'$'}}
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="footer">
              <tr>
                <td>Total</td>
                <td>{{totalRecargas | currency:'$'}}</td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="8">Sin registros</td>
              </tr>
            </ng-template>
            <ng-template pTemplate="loadingbody">
              <tr>
                <td colspan="8">Cargando información, por favor espere</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>

      <div class="col-12 xl:col-6">
        <div class="grid">
          <div class="col-12">
            <div class="card">
              <h5>Recargas realizadas</h5>
              <p-table [loading]="spinRecargas" #tableRecargas [value]="listRecargas" dataKey="code" [rows]="5" [paginator]="true" responsiveLayout="scroll" (onFilter)="filtroRecargas($event, tableRecargas)" [globalFilterFields]="['administrador','cliente','valor_recarga','fecha_recarga']">
                <ng-template pTemplate="caption">
                  <div class="flex justify-content-between flex-column sm:flex-row">
                    <button pButton label="Borrar filtros" class="p-button-outlined mb-2" icon="pi pi-filter-slash" (click)="clear(tableRecargas)"></button>
                  </div>
                </ng-template>
                <ng-template pTemplate="header">
                  <tr>
                    <th pSortableColumn="administrador">Administrador
                      <p-sortIcon field="administrador"></p-sortIcon>
                    </th>
                    <th pSortableColumn="cliente">Cliente
                      <p-sortIcon field="cliente"></p-sortIcon>
                    </th>
                    <th pSortableColumn="valor_recarga">Valor recarga
                      <p-sortIcon field="valor_recarga"></p-sortIcon>
                    </th>
                    <th pSortableColumn="fecha_recarga">Fecha
                      <p-sortIcon field="fecha_recarga"></p-sortIcon>
                    </th>
                    <th></th>
                  </tr>
                  <tr>
                    <th>
                      <p-columnFilter type="text" field="administrador"></p-columnFilter>
                    </th>
                    <th>
                      <p-columnFilter type="text" field="cliente"></p-columnFilter>
                    </th>
                    <th>
                    </th>
                    <th>
                      <div class="flex justify-content-between flex-column sm:flex-row">
                        <p-calendar selectionMode="range" [showIcon]="true" [readonlyInput]="true" inputId="range" [touchUI]="true" placeholder="Rango de fechas" [(ngModel)]="rangoFechasRecargas"></p-calendar>
                        <button type="button" pButton pRipple icon="pi pi-search" class="ml-2" (click)="getRecargasPorFechas()"></button>
                      </div>
                    </th>
                    <th>
                    </th>
                  </tr>


                </ng-template>
                <ng-template pTemplate="body" let-data>
                  <tr>
                    <td style="min-width: 12rem;">
                      {{data.administrador}}
                    </td>
                    <td style="min-width: 12rem;">
                      {{data.cliente}}
                    </td>
                    <td style="min-width: 12rem;">
                      {{data.valor_recarga | currency:'$'}}
                    </td>
                    <td style="min-width: 12rem;">
                      {{data.fecha_recarga | date:'dd-MM-yyyy'}}
                    </td>
                    <td class="flex justify-content-center flex-column sm:flex-row">
                      <button type="button" pButton pRipple icon="pi pi-file" (click)="verArchivosRecarga(data)" [ngClass]="{'p-button-outlined': data.tiene_archivos == 0}"></button>
                      <button type="button" pButton pRipple icon="pi pi-search" (click)="getDetalleRecarga(data)" class="ml-3"></button>

                    </td>
                  </tr>
                </ng-template>
                <ng-template pTemplate="footer">
                  <tr>
                    <td colspan="2">Total</td>
                    <td>{{totalRecargasRealizadas | currency:'$'}}</td>
                    <td colspan="2"></td>
                  </tr>
                  <tr>
                    <td colspan="2">Promedio</td>
                    <td>{{totalPromedioRecargasRealizadas | currency:'$'}}</td>
                    <td colspan="2"></td>
                  </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                  <tr>
                    <td colspan="8">Sin registros</td>
                  </tr>
                </ng-template>
                <ng-template pTemplate="loadingbody">
                  <tr>
                    <td colspan="8">Cargando información, por favor espere</td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
          </div>
        </div>
      </div>


      <div class="col-12 xl:col-6">
        <div class="card">
          <h5>Detalle recarga</h5>
          <p-table [loading]="spinDetalleRecarga" #tableDetalleRecargas [value]="listDetalleRecargas" dataKey="code" [rows]="5" [paginator]="true" responsiveLayout="scroll">
            <ng-template pTemplate="header">
              <tr>
                <th>Usuario</th>
                <th>Valor recarga</th>
                <th>Valor venta</th>
                <th>Balance</th>
                <th></th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-data>
              <tr>
                <td style="min-width: 12rem;">
                  {{data.persona}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.total_recarga | currency:'$'}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.total_ventas | currency: '$'}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.balance | currency: '$'}}
                </td>
                <td>
                  <button type="button" pButton pRipple icon="pi pi-search" (click)="getComprasPorPersona('None', data.persona)"></button>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="footer">
              <tr>
                <td>Total</td>
                <td>{{totalValorRecargaDetalle | currency:'$'}}</td>
                <td>{{totalValorVentaRecargaDetalle | currency:'$'}}</td>
                <td>{{totalBalanceRecargaDetalle | currency:'$'}}</td>
                <td></td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="8">Sin registros</td>
              </tr>
            </ng-template>
            <ng-template pTemplate="loadingbody">
              <tr>
                <td colspan="8">Cargando información, por favor espere</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
        <div class="card">
          <h5>Comisiones</h5>
          <p-table [loading]="spinDetalleRecarga" #tableComisiones [value]="listComisiones" dataKey="code" [rows]="4" [paginator]="true" responsiveLayout="scroll" (onFilter)="filtroComisiones($event,tableComisiones)" [globalFilterFields]="['usuario_vendedor','producto']">
            <ng-template pTemplate="caption">
              <div class="flex justify-content-between flex-column sm:flex-row">
                <button pButton label="Borrar filtros" class="p-button-outlined mb-2" icon="pi pi-filter-slash" (click)="clear(tableComisiones)"></button>
              </div>
            </ng-template>
            <ng-template pTemplate="header">
              <tr>
                <th pSortableColumn="usuario_vendedor">Usuario
                  <p-sortIcon field="usuario_vendedor"></p-sortIcon>
                </th>
                <th pSortableColumn="fecha_transaccion">Fecha transacción
                  <p-sortIcon field="fecha_transaccion"></p-sortIcon>
                </th>
                <th pSortableColumn="producto">Producto
                  <p-sortIcon field="producto"></p-sortIcon>
                </th>
                <th pSortableColumn="comisiones">Comisiones
                  <p-sortIcon field="comisiones"></p-sortIcon>
                </th>
              </tr>
              <tr>
                <th>
                  <p-columnFilter type="text" field="usuario_vendedor" ></p-columnFilter>
                </th>
                <th>
                  <div class="flex justify-content-between flex-column sm:flex-row">
                    <p-calendar selectionMode="range" [showIcon]="true" [readonlyInput]="true" inputId="range" [touchUI]="true" placeholder="Rango de fechas" [(ngModel)]="rangoFechasComisiones"></p-calendar>
                    <button type="button" pButton pRipple icon="pi pi-search" class="ml-2" (click)="getComisionesPorFechas()"></button>
                  </div>
                </th>
                <th>
                  <p-columnFilter type="text" field="producto"></p-columnFilter>
                </th>
                <th>
                </th>
                <th>
                </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-data>
              <tr>
                <td style="min-width: 12rem;">
                  {{data.usuario_vendedor}}

                </td>
                <td style="min-width: 12rem;">
                  {{data.fecha_transaccion | date: 'dd-MM-yyyy'}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.producto }}
                </td>
                <td style="min-width: 12rem;">
                  {{data.comisiones | currency: '$'}}
                </td>
                <td>
                  <button type="button" pButton pRipple icon="pi pi-search" (click)="getComprasPorPersona('None', data.usuario_vendedor)"></button>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="footer">
              <tr>
                <td colspan="3">Total</td>
                <td>{{cantTotalComisiones | currency:'$'}}</td>
                <td></td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="8">Sin registros</td>
              </tr>
            </ng-template>
            <ng-template pTemplate="loadingbody">
              <tr>
                <td colspan="8">Cargando información, por favor espere</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>

    </div>

    <!--Ventas por producto-->
    <div class="grid ">

      <div class="col-12 xl:col-6">
        <div class="card">
          <h5>Ventas por producto</h5>
          <p-table [loading]="spinVentasProducto" #tableVXP [value]="listProductosMasVendidos" dataKey="code" (onFilter)="filtroProductos($event,tableVXP)" selectionMode="single" [rows]="5" [paginator]="true" responsiveLayout="scroll" [globalFilterFields]="['nombre_producto','fecha_transaccion']">
            <ng-template pTemplate="caption">
              <div class="flex justify-content-between flex-column sm:flex-row">
                <button pButton label="Borrar filtros" class="p-button-outlined mb-2" icon="pi pi-filter-slash" (click)="clear(tableVXP)"></button>
              </div>
            </ng-template>
            <ng-template pTemplate="header">
              <tr>
                <th pSortableColumn="nombre_producto">
                  <div class="flex justify-content-between align-items-center">
                    Producto
                  </div>
                </th>
                <th pSortableColumn="fecha_transaccion">
                  <div class="flex justify-content-between align-items-center">
                    Fecha
                    <p-sortIcon field="fecha_transaccion"></p-sortIcon>
                  </div>
                </th>
                <th pSortableColumn="cantidad">
                  <div class="flex justify-content-between align-items-center">
                    Cantidad
                    <p-sortIcon field="cantidad"></p-sortIcon>
                  </div>
                </th>
                <th pSortableColumn="total_venta">
                  <div class="flex justify-content-between align-items-center">
                    Total ventas
                    <p-sortIcon field="total_venta"></p-sortIcon>
                  </div>
                </th>
                <th></th>
              </tr>
              <tr>
                <th>
                  <p-columnFilter type="text" field="nombre_producto"></p-columnFilter>
                </th>
                <th>
                  <div class="flex justify-content-between flex-column sm:flex-row">
                    <p-calendar selectionMode="range" [showIcon]="true" [readonlyInput]="true" inputId="range" [touchUI]="true" placeholder="Rango de fechas" [(ngModel)]="rangoFechasProductos"></p-calendar>
                    <button type="button" pButton pRipple icon="pi pi-search" class="ml-2" (click)="getProductosMasVendidosFiltro()"></button>
                  </div>
                </th>
                <th></th>
                <th></th>
                <th></th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-data>
              <tr>
                <td style="min-width: 12rem;">
                  {{data.nombre_producto}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.fecha_transaccion | date:'dd-MM-yyyy'}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.cantidad}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.total_venta | currency:'$'}}
                </td>
                <td>
                  <button type="button" pButton pRipple icon="pi pi-search" (click)="getComprasPorPersona(data.nombre_producto,'None')"></button>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="footer">
              <tr>
                <td colspan="2">Total</td>
                <td>{{cantProdVendidos }}</td>
                <td>{{totalProdVendidos | currency:'$'}}</td>
                <td></td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="8">Sin registros</td>
              </tr>
            </ng-template>
            <ng-template pTemplate="loadingbody">
              <tr>
                <td colspan="8">Cargando información, por favor espere</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
      <div class="col-12 xl:col-6">
        <div class="card">
          <h5>Ventas por persona</h5>
          <p-table [loading]="spinVentasPersona" #tableVentasXPersona [value]="listPersonasMasVentas" [rows]="5" (onFilter)="filtroPersona($event,tableVentasXPersona)" [paginator]="true" responsiveLayout="scroll" [globalFilterFields]="['nombre_persona']">
            <ng-template pTemplate="caption">
              <div class="flex justify-content-between flex-column sm:flex-row">
                <button pButton label="Borrar filtros" class="p-button-outlined mb-2" icon="pi pi-filter-slash" (click)="clear(tableVentasXPersona)"></button>
              </div>
            </ng-template>
            <ng-template pTemplate="header">
              <tr>
                <th pSortableColumn="nombre_persona">
                  <div class="flex justify-content-between align-items-center">
                    Persona
                  </div>
                </th>
                <th pSortableColumn="fecha_transaccion">
                  <div class="flex justify-content-between align-items-center">
                    Fecha
                    <p-sortIcon field="fecha_transaccion"></p-sortIcon>
                  </div>
                </th>
                <th pSortableColumn="cantidad">
                  <div class="flex justify-content-between align-items-center">
                    Cantidad
                    <p-sortIcon field="cantidad"></p-sortIcon>
                  </div>
                </th>
                <th pSortableColumn="total_venta">
                  <div class="flex justify-content-between align-items-center">
                    Total ventas
                    <p-sortIcon field="total_venta"></p-sortIcon>
                  </div>
                </th>
                <th></th>
              </tr>
              <tr>
                <th>
                  <p-columnFilter type="text" field="nombre_persona"></p-columnFilter>
                </th>
                <th>
                  <div class="flex justify-content-between flex-column sm:flex-row">
                    <p-calendar selectionMode="range" [showIcon]="true" [readonlyInput]="true" inputId="range" [touchUI]="true" placeholder="Rango de fechas" [(ngModel)]="rangoFechasPersona"></p-calendar>
                    <button type="button" pButton pRipple icon="pi pi-search" class="ml-2" (click)="getPersonasConMasVentasFiltro()"></button>
                  </div>
                </th>
                <th></th>
                <th></th>
                <th></th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-data>
              <tr>
                <td style="min-width: 12rem;">
                  {{data.nombre_persona}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.fecha_transaccion | date:'dd-MM-yyyy'}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.cantidad}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.total_venta | currency:'$'}}
                </td>
                <td>
                  <button type="button" pButton pRipple icon="pi pi-search" (click)="getComprasPorPersona('None',data.nombre_persona)"></button>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="footer">
              <tr>
                <td colspan="2">Total</td>
                <td>{{cantPersVendidos }}</td>
                <td>{{totalPersVendidos | currency:'$'}}</td>
                <td></td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="8">Sin registros</td>
              </tr>
            </ng-template>
            <ng-template pTemplate="loadingbody">
              <tr>
                <td colspan="8">Cargando información, por favor espere</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>

      <div class="col-12 xl:col-12">
        <div class="card">
          <h5>Ventas por persona y producto</h5>
          <p-table [loading]="spinVentaPersonaProducto" #tableVentasYProducto [value]="listVentasPorPersona" [rows]="5" (onFilter)="filtroProdPerson($event,tableVentasYProducto)" [paginator]="true" responsiveLayout="scroll" [globalFilterFields]="['nombre_persona','nombre_producto','cantidad_ventas','valor_unitario','total_vendido','costo','utilidad']">
            <ng-template pTemplate="caption">
              <div class="flex justify-content-between flex-column sm:flex-row">
                <button pButton label="Borrar filtros" class="p-button-outlined mb-2" icon="pi pi-filter-slash" (click)="clear(tableVentasYProducto)"></button>
              </div>
            </ng-template>
            <ng-template pTemplate="header">
              <tr>
                <th pSortableColumn="nombre_persona">
                  <div class="flex justify-content-between align-items-center">
                    Persona
                    <p-sortIcon field="nombre_persona"></p-sortIcon>
                  </div>
                </th>
                <th pSortableColumn="nombre_producto">
                  <div class="flex justify-content-between align-items-center">
                    Producto
                    <p-sortIcon field="nombre_producto"></p-sortIcon>
                  </div>
                </th>
                <th pSortableColumn="fecha_transaccion">
                  <div class="flex justify-content-between align-items-center">
                    Fecha
                    <p-sortIcon field="fecha_transaccion"></p-sortIcon>
                  </div>
                </th>
                <th pSortableColumn="cantidad_ventas">
                  <div class="flex justify-content-between align-items-center">
                    Cantidad Ventas
                    <p-sortIcon field="cantidad_ventas"></p-sortIcon>
                  </div>
                </th>
                <th pSortableColumn="valor_unitario">
                  <div class="flex justify-content-between align-items-center">
                    Valor unitario
                    <p-sortIcon field="valor_unitario"></p-sortIcon>
                  </div>
                </th>
                <th pSortableColumn="total_vendido">
                  <div class="flex justify-content-between align-items-center">
                    Valor total
                    <p-sortIcon field="total_vendido"></p-sortIcon>
                  </div>
                </th>
                <th pSortableColumn="costo">
                  <div class="flex justify-content-between align-items-center">
                    Costo
                    <p-sortIcon field="costo"></p-sortIcon>
                  </div>
                </th>
                <th pSortableColumn="utilidad">
                  <div class="flex justify-content-between align-items-center">
                    Utilidad
                    <p-sortIcon field="utilidad"></p-sortIcon>
                  </div>
                </th>
                <th></th>
              </tr>
              <tr>
                <th>
                  <p-columnFilter type="text" field="nombre_persona" ></p-columnFilter>
                </th>
                <th>
                  <p-columnFilter type="text" field="nombre_producto" ></p-columnFilter>
                </th>
                <th>
                  <div class="flex justify-content-end flex-column sm:flex-row">
                    <p-calendar selectionMode="range" [showIcon]="true" [readonlyInput]="true" inputId="range" [touchUI]="true" placeholder="Rango de fechas" [(ngModel)]="rangoFechasProdPerson"></p-calendar>
                    <button type="button" pButton pRipple icon="pi pi-search" class="ml-2" (click)="getComprasPorPersonaFiltro()"></button>
                  </div>
                </th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
              </tr>

            </ng-template>
            <ng-template pTemplate="body" let-data>
              <tr>
                <td style="min-width: 12rem;">
                  {{data.nombre_persona}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.nombre_producto}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.fecha_transaccion | date:'dd-MM-yyyy'}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.cantidad_ventas}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.valor_unitario|currency:'$'}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.valor_total|currency:'$'}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.costo|currency:'$'}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.utilidad|currency:'$'}}
                </td>
                <td>
                  <button type="button" pButton pRipple icon="pi pi-search" (click)="getDetalleVenta(data)"></button>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="footer">
              <tr>
                <td colspan="3">Total</td>
                <td>{{cantVentasPerProd }}</td>
                <td>{{totalUnitarioPerProd | currency:'$'}}</td>
                <td>{{totalGenePerProd | currency:'$'}}</td>
                <td>{{totalCostPerProd | currency:'$'}}</td>
                <td>{{totalUtilPerProd | currency:'$'}}</td>
                <td colspan="2"></td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="8">Sin registros</td>
              </tr>
            </ng-template>
            <ng-template pTemplate="loadingbody">
              <tr>
                <td colspan="8">Cargando información, por favor espere</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>

    </div>


    <div class="grid">

      <div class="col-12 xl:col-12">
        <div class="card">
          <h5>Detalle de venta</h5>
          <p-table [loading]="spinDetalleVenta" #tableDetalleVenta [value]="listDetalleVenta" [rows]="5" [paginator]="true" (onFilter)="filtroDetalleVenta($event,tableDetalleVenta)" responsiveLayout="scroll" [globalFilterFields]="['usuario_vendedor','usuario_cliente','producto','fecha_transaccion','valor_venta','costo_producto','utilidad']">
            <ng-template pTemplate="caption">
              <div class="flex justify-content-between flex-column sm:flex-row">
                <button pButton label="Borrar filtros" class="p-button-outlined mb-2" icon="pi pi-filter-slash" (click)="clear(tableDetalleVenta)"></button>
              </div>
            </ng-template>
            <ng-template pTemplate="header">
              <tr>
                <th pSortableColumn="usuario_vendedor">
                  <div class="flex justify-content-between align-items-center">
                    Vendedor
                    <p-sortIcon field="usuario_vendedor"></p-sortIcon>
                  </div>
                </th>
                <th pSortableColumn="usuario_cliente">
                  <div class="flex justify-content-between align-items-center">
                    Comprador
                    <p-sortIcon field="usuario_cliente"></p-sortIcon>
                  </div>
                </th>
                <th pSortableColumn="producto">
                  <div class="flex justify-content-between align-items-center">
                    Producto
                    <p-sortIcon field="producto"></p-sortIcon>
                  </div>
                </th>
                <th pSortableColumn="fecha_transaccion">
                  <div class="flex justify-content-between align-items-center">
                    Fecha
                    <p-sortIcon field="fecha_transaccion"></p-sortIcon>
                  </div>
                </th>
                <th pSortableColumn="valor_venta">
                  <div class="flex justify-content-between align-items-center">
                    Valor venta
                    <p-sortIcon field="valor_venta"></p-sortIcon>
                  </div>
                </th>
                <th pSortableColumn="costo_producto">
                  <div class="flex justify-content-between align-items-center">
                    Costo producto
                    <p-sortIcon field="costo_producto"></p-sortIcon>
                  </div>
                </th>
                <th pSortableColumn="utilidad">
                  <div class="flex justify-content-between align-items-center">
                    Utilidad
                    <p-sortIcon field="utilidad"></p-sortIcon>
                  </div>
                </th>
              </tr>
              <tr>
                <th>
                  <p-columnFilter type="text" field="usuario_vendedor"></p-columnFilter>
                </th>
                <th>
                  <p-columnFilter type="text" field="usuario_cliente" ></p-columnFilter>
                </th>
                <th>
                  <p-columnFilter type="text" field="producto" ></p-columnFilter>
                </th>
                <th>
                  <div class="flex justify-content-end flex-column sm:flex-row">
                    <p-calendar selectionMode="range" [showIcon]="true" [readonlyInput]="true" inputId="range" [touchUI]="true" placeholder="Rango de fechas" [(ngModel)]="rangoFechasDetalleVenta"></p-calendar>
                    <button type="button" pButton pRipple icon="pi pi-search" class="ml-2" (click)="getDetalleVentaFiltro()"></button>
                  </div>
                </th>
                <th colspan="3"></th>
              </tr>

            </ng-template>
            <ng-template pTemplate="body" let-data>
              <tr>
                <td style="min-width: 12rem;">
                  {{data.usuario_vendedor}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.usuario_cliente}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.producto}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.fecha_transaccion | date:'dd-MM-yyyy'}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.saldo_adicional|currency:'$'}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.costo_producto|currency:'$'}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.utilidad| currency:'$'}}
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="footer">
              <tr>
                <td colspan="4">Total</td>
                <td>{{totalValorVentaDetalle | currency:'$'}}</td>
                <td>{{totalCostoDetalle | currency:'$'}}</td>
                <td>{{totalUtilidadDetalle | currency:'$'}}</td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="8">Sin registros</td>
              </tr>
            </ng-template>
            <ng-template pTemplate="loadingbody">
              <tr>
                <td colspan="8">Cargando información, por favor espere</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
    </div>

  </div>

</div>


<p-dialog header="Archivos" [(visible)]="display" [modal]="true" [style]="{width: '70vw'}" [draggable]="false" [resizable]="false">
  <ng-template pTemplate="body">

    <div class="card">
      <h5>Recarga seleccionada</h5>
      <p-table [value]="[0]" responsiveLayout="scroll">
        <ng-template pTemplate="header">
          <tr>
            <th>Administrador</th>
            <th>Cliente</th>
            <th>Valor recarga</th>
            <th>Fecha</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body">
          <tr>
            <td>{{recargaSeleccionada.administrador}}</td>
            <td>{{recargaSeleccionada.cliente}}</td>
            <td style="min-width: 12rem;">
              {{recargaSeleccionada.fecha_recarga | date:'dd-MM-yyyy'}}
            </td>
            <td style="min-width: 12rem;">
              {{recargaSeleccionada.valor_recarga | currency:'$'}}
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>

    <form #formArchivo="ngForm" (ngSubmit)="saveArchivo(formArchivo.value)">
      <div class="card p-fluid">
        <h5>Agregar archivo</h5>
        <div class="p-formgrid grid">
          <div class="field col">
            <label>Banco</label>
            <input pInputText id="bancoT" name="bancoT" type="text" ngModel required="true" />
          </div>
          <div class="field col">
            <label>Cuenta</label>
            <input pInputText id="cuenta" name="cuentaT" type="text" ngModel required="true" />
          </div>
          <div class="field col">
            <label>valor</label>
            <p-inputNumber id="valorT" name="valorT" ngModel required="true"></p-inputNumber>
          </div>
        </div>
        <div class="p-formgrid grid">
          <div class="field col">
            <label>Fecha</label>
            <p-calendar name="calendarT" [showIcon]="true" [showTime]="true" inputId="time" ngModel required="true"></p-calendar>
          </div>
          <div class="field col">
            <label>N° de comprobante</label>
            <input pInputText id="comprobante" name="comprobante" type="text" ngModel required="true" />
          </div>
          <div class="field col">
            <label>Archivo</label>
            <div class="flex justify-content-start">
              <p-fileUpload mode="basic" chooseLabel="Seleccione" #fileUpload (onSelect)="subirArchivoSoporte($event)"></p-fileUpload>
              <button type="button" pButton pRipple icon="pi pi-trash" class="p-button-danger ml-2" (click)="cambiarArchivo(fileUpload)"></button>
            </div>
          </div>
        </div>
        <button type="submit" pButton label="Guardar" [disabled]="formArchivo.invalid && fileSoporte == null"></button>
        <p-messages></p-messages>

      </div>
    </form>

    <div class="card">
      <h5>Lista de archivos</h5>
      <p-table [loading]="spinListaArchivos" #tableComisiones [value]="listArchivos" [rows]="5" [paginator]="true" responsiveLayout="scroll" [globalFilterFields]="['banco','cuenta','valor','fecha','hora','numero_comprobante']">
        <ng-template pTemplate="caption">
          <div class="flex justify-content-between flex-column sm:flex-row">
            <button pButton label="Borrar filtros" class="p-button-outlined mb-2" icon="pi pi-filter-slash" (click)="clear(tableComisiones)"></button>
            <span class="p-input-icon-left mb-2">
                <i class="pi pi-search"></i>
                <input pInputText type="text" #filterProd (input)="tableComisiones.filterGlobal($event.target.value, 'contains')" placeholder="Buscar transacción" class="w-full"/>
            </span>
          </div>
        </ng-template>
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="banco">Banco
              <p-sortIcon field="banco"></p-sortIcon>
            </th>
            <th pSortableColumn="cuenta">Cuenta
              <p-sortIcon field="cuenta"></p-sortIcon>
            </th>
            <th pSortableColumn="valor">Valor
              <p-sortIcon field="valor"></p-sortIcon>
            </th>
            <th pSortableColumn="fecha">Fecha
              <p-sortIcon field="fecha"></p-sortIcon>
            </th>
            <th pSortableColumn="hora">Hora
              <p-sortIcon field="hora"></p-sortIcon>
            </th>
            <th pSortableColumn="cuenta">Cuenta
              <p-sortIcon field="cuenta"></p-sortIcon>
            </th>
            <th pSortableColumn="numero_comprobante">N° de comprobante
              <p-sortIcon field="numero_comprobante"></p-sortIcon>
            </th>
            <th>Archivo</th>
            <th></th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-data>
          <tr>
            <td style="min-width: 12rem;">
              {{data.banco}}
            </td>
            <td style="min-width: 12rem;">
              {{data.cuenta}}
            </td>
            <td style="min-width: 12rem;">
              {{data.valor | currency:'$'}}
            </td>
            <td style="min-width: 12rem;">
              {{data.fecha}}
            </td>
            <td style="min-width: 12rem;">
              {{data.hora}}
            </td>
            <td style="min-width: 12rem;">
              {{data.cuenta}}
            </td>
            <td style="min-width: 12rem;">
              {{data.numero_comprobante}}
            </td>
            <td style="min-width: 12rem;">
              <p-image [src]="data.archivo" width="150" [preview]="true" styleClass="imageClass"></p-image>
            </td>
            <td style="min-width: 12rem;">
              <div class="flex justify-content-start">
                <button type="button" pButton pRipple icon="pi pi-trash" class="p-button-danger mr-3" (click)="eliminarArchivo($event,data)"></button>
                <p-confirmPopup key="confirm2"></p-confirmPopup>

              </div>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="8">Sin registros</td>
          </tr>
        </ng-template>
        <ng-template pTemplate="loadingbody">
          <tr>
            <td colspan="8">Cargando información, por favor espere</td>
          </tr>
        </ng-template>
      </p-table>
    </div>

  </ng-template>
  <ng-template pTemplate="footer">
    <p-button icon="pi pi-check" (click)="display=false" label="Ok" styleClass="p-button-text"></p-button>
  </ng-template>
</p-dialog>
