<p-toast></p-toast>
<div class="grid">
  <div class="col-12">
    <div class="card" *ngIf="!archivosCargados">
      <h5>Seleccione los archivos </h5>
      <p-fileUpload name="myfile[]" customUpload="true" (uploadHandler)="onUpload($event)" multiple="multiple" accept=".xlsx" maxFileSize="1000000" chooseLabel="Agregar" uploadLabel="Cargar" cancelLabel="Cancelar">
      </p-fileUpload>
    </div>

    <!--Indicadores-->
    <div class="grid mb-3">
      <div class="col-12 lg:col-4 xl:col-4" *ngFor="let item of listIndicadores">
        <div class="card mb-0">
          <div class="flex justify-content-between mb-3">
            <div>
              <span class="block text-500 font-medium mb-3">{{item.nombre_indicador}}</span>
              <div class="text-900 font-medium text-xl" *ngIf="item.esMoneda">{{item.valor|currency:'$'}}</div>
              <div class="text-900 font-medium text-xl" *ngIf="!item.esMoneda">{{item.valor}}</div>
            </div>
            <div class="flex align-items-center justify-content-center bg-blue-100 border-round" [ngStyle]="{width: '2.5rem', height: '2.5rem'}">
              <i class="pi {{item.icono}} text-blue-500 text-xl"></i>
            </div>
          </div>
          <span class="text-green-500 font-medium">{{item.resaltado}} </span>
          <span class="text-500">{{item.descripcion}}</span>
        </div>
      </div>
    </div>

    <div class="grid" *ngIf="archivosCargados">

      <div class="col-12 xl:col-4">
        <div class="card">
          <h5>Modificar productos</h5>
          <p-table #tableProductos [value]="listProductos" dataKey="code" [rows]="5" [paginator]="true" responsiveLayout="scroll">
            <ng-template pTemplate="header">
              <tr>
                <th>
                  <div class="flex justify-content-between align-items-center">
                    Producto
                  </div>
                </th>
                <th>Costo</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-data>
              <tr>
                <td style="min-width: 12rem;">
                  {{data.nombre}}
                </td>
                <td style="min-width: 12rem;">
                  <p-inputNumber mode="decimal" [(ngModel)]="data.costo_unitario"></p-inputNumber>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="8">Sin registros</td>
              </tr>
            </ng-template>
            <ng-template pTemplate="loadingbody">
              <tr>
                <td colspan="8">Cargando información, por favor espere</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>

      <div class="col-12 xl:col-8">
        <div class="grid">
          <div class="col-12">
            <div class="card">
              <h5>Recargas realizadas</h5>
              <p-table #tableRecargas [value]="listRecargas" dataKey="code" [rows]="5" [paginator]="true" responsiveLayout="scroll">
                <ng-template pTemplate="header">
                  <tr>
                    <th pSortableColumn="administrador">Administrador
                      <p-sortIcon field="administrador"></p-sortIcon>
                    </th>
                    <th pSortableColumn="cliente">Cliente
                      <p-sortIcon field="cliente"></p-sortIcon>
                    </th>
                    <th pSortableColumn="valor_recarga">Valor recarga
                      <p-sortIcon field="valor_recarga"></p-sortIcon>
                    </th>
                    <th pSortableColumn="fecha_recarga">Fecha
                      <p-sortIcon field="fecha_recarga"></p-sortIcon>
                    </th>
                    <th></th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-data>
                  <tr>
                    <td style="min-width: 12rem;">
                      {{data.administrador}}
                    </td>
                    <td style="min-width: 12rem;">
                      {{data.cliente}}
                    </td>
                    <td style="min-width: 12rem;">
                      {{data.valor_recarga | currency:'$'}}
                    </td>
                    <td style="min-width: 12rem;">
                      {{data.fecha_recarga}}
                    </td>
                    <td>
                      <button type="button" pButton pRipple icon="pi pi-search" (click)="getDetalleRecarga(data)"></button>
                    </td>
                  </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                  <tr>
                    <td colspan="8">Sin registros</td>
                  </tr>
                </ng-template>
                <ng-template pTemplate="loadingbody">
                  <tr>
                    <td colspan="8">Cargando información, por favor espere</td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
          </div>
        </div>
      </div>

      <div class="col-12">
        <div class="card">
          <h5>Detalle recarga</h5>
          <p-table #tableDetalleRecargas [value]="listDetalleRecargas" dataKey="code" [rows]="5" [paginator]="true" responsiveLayout="scroll">
            <ng-template pTemplate="header">
              <tr>
                <th>Usuario</th>
                <th>Valor recarga</th>
                <th>Valor venta</th>
                <th>Balance</th>
                <th></th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-data>
              <tr>
                <td style="min-width: 12rem;">
                  {{data.persona}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.total_recarga | currency:'$'}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.total_ventas | currency: '$'}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.balance | currency: '$'}}
                </td>
                <td>
                  <button type="button" pButton pRipple icon="pi pi-search" (click)="getComprasPorPersona(null, data.persona)"></button>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="8">Sin registros</td>
              </tr>
            </ng-template>
            <ng-template pTemplate="loadingbody">
              <tr>
                <td colspan="8">Cargando información, por favor espere</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>

    </div>

    <!--Ventas por producto-->
    <div class="grid ">

      <div class="col-12 xl:col-4">
        <div class="card">
          <h5>Ventas por producto</h5>
          <p-table #tableVXP [value]="listProductosMasVendidos" dataKey="code" selectionMode="single" [rows]="5" [paginator]="true" responsiveLayout="scroll">
            <ng-template pTemplate="header">
              <tr>
                <th>
                  <div class="flex justify-content-between align-items-center">
                    Producto
                  </div>
                </th>
                <th pSortableColumn="cantidad">
                  <div class="">
                    Cantidad
                    <p-sortIcon field="cantidad"></p-sortIcon>
                  </div>
                </th>
                <th></th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-data>
              <tr>
                <td style="min-width: 12rem;">
                  {{data.nombre_producto}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.cantidad}}
                </td>
                <td>
                  <button type="button" pButton pRipple icon="pi pi-search" (click)="getComprasPorPersona(data.nombre_producto,null)"></button>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="8">Sin registros</td>
              </tr>
            </ng-template>
            <ng-template pTemplate="loadingbody">
              <tr>
                <td colspan="8">Cargando información, por favor espere</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>

      <div class="col-12 xl:col-8">
        <div class="card">
          <h5>Ventas por persona y producto</h5>
          <p-table #tableVentasYProducto [value]="listComprasPorPersona" [rows]="5" [paginator]="true" responsiveLayout="scroll">
            <ng-template pTemplate="header">
              <tr>
                <th pSortableColumn="nombre_persona">
                  <div class="flex justify-content-between align-items-center">
                    Persona
                    <p-sortIcon field="nombre_persona"></p-sortIcon>
                  </div>
                </th>
                <th pSortableColumn="nombre_producto">
                  <div class="flex justify-content-between align-items-center">
                    Producto
                    <p-sortIcon field="nombre_producto"></p-sortIcon>
                  </div>
                </th>
                <th pSortableColumn="cantidad_ventas">
                  <div class="flex justify-content-between align-items-center">
                    Cantidad Ventas
                    <p-sortIcon field="cantidad_ventas"></p-sortIcon>
                  </div>
                </th>
                <th pSortableColumn="cantidad_ventas">
                  <div class="flex justify-content-between align-items-center">
                    Valor unitario
                    <p-sortIcon field="cantidad_ventas"></p-sortIcon>
                  </div>
                </th>
                <th pSortableColumn="total_vendido">
                  <div class="flex justify-content-between align-items-center">
                    Valor total
                    <p-sortIcon field="total_vendido"></p-sortIcon>
                  </div>
                </th>
                <th></th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-data>
              <tr>
                <td style="min-width: 12rem;">
                  {{data.nombre_persona}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.nombre_producto}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.cantidad_ventas}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.valor_unitario|currency:'$'}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.valor_total|currency:'$'}}
                </td>
                <td>
                  <button type="button" pButton pRipple icon="pi pi-search" (click)="getComprasPorPersona(data)"></button>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="6">Sin registros</td>
              </tr>
            </ng-template>
            <ng-template pTemplate="loadingbody">
              <tr>
                <td colspan="6">Cargando información, por favor espere</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>

    </div>


    <div class="grid">
      <div class="col-12 xl:col-4">
        <div class="card">
          <h5>Ventas por persona</h5>
          <p-table #tableVentasXPersona [value]="listPersonasMasVentas" [rows]="5" [paginator]="true" responsiveLayout="scroll">
            <ng-template pTemplate="header">
              <tr>
                <th>
                  <div class="flex justify-content-between align-items-center">
                    Persona
                  </div>
                </th>
                <th pSortableColumn="cantidad">
                  <div class="">
                    Cantidad
                    <p-sortIcon field="cantidad"></p-sortIcon>
                  </div>
                </th>
                <th></th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-data>
              <tr>
                <td style="min-width: 12rem;">
                  {{data.nombre_persona}}
                </td>
                <td style="min-width: 12rem;">
                  {{data.cantidad}}
                </td>
                <td>
                  <button type="button" pButton pRipple icon="pi pi-search" (click)="getComprasPorPersona(null,data.nombre_persona)"></button>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="8">Sin registros</td>
              </tr>
            </ng-template>
            <ng-template pTemplate="loadingbody">
              <tr>
                <td colspan="8">Cargando información, por favor espere</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
    </div>

  </div>

</div>
